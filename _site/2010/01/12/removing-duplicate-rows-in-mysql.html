<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="author" content="Creative Commons">
      <meta name="viewport" content="width=device-width">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">
      <link rel="stylesheet" href="/css/main.css">
      <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
      <link rel="icon" href="/favicon.ico" type="image/x-icon">
      <link rel="alternate" type="application/atom+xml" href="/atom.xml">
      <title>Removing duplicate rows in MySQL&mdash;Creative Commons Labs</title>
   </head>
   
   <body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Creative Commons Labs</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/blog">Read our blog</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<div class="container">

      <div class="starter-template">

	<h1><a href="/">Creative Commons Labs</a></h1>

	<p><small>Website of the Creative Commons tech team.
</small>
	</p>

      </div>

      <div class="row">

	<div class="col-md-12">

  	<div class="post">

  
  <div class="bg-danger text-center" id="old-posts">
    <p>Please note, this is an old blog post from several years ago. It may contain out of date information. If you spot anything broken or missing, <a target="_blank" href="https://github.com/creativecommons/labs/issues">please file a bug</a>.</p>
  </div>
  

  <header class="post-header">
    <h1 class="post-title">Removing duplicate rows in MySQL</h1>
    <p class="post-meta">Jan 12, 2010 by nkinkade</p>
  </header>

  <article class="post-content">
    <p>There are thousands of articles out there on removing duplicate rows from a SQL database.  However, almost all of the first-page results of a search at Google for something like "<em>mysql remove duplicates</em>" involved creating temporary tables and other convoluted ways of solving the problem.  I'm posting this simple method here in the hope that it could simplify this process for someone else.  This is likely old news for people highly experienced with MySQL and SQL databases in general, but it's not that frequent that I have to tackle the duplicate row issue, so I post here for my own reference and that of others.  The idea is that you create a unique index on the table based on the columns that should not be duplicated.  MySQL will delete the duplicates in order to comply with the uniqueness of the index created.  You then simply remove the temporary index.</p>
<p>There was <a href="http://issues.civicrm.org/jira/browse/CRM-3901">a bug</a> in <a href="http://civicrm.org">CiviCRM</a> which was causing duplicate records in a particular table.  Find the duplicates:</p>
<p><code>mysql> SELECT contact_id, contribution_id, receive_date, product_id, count(*) FROM civicrm_contribution_product JOIN civicrm_contribution ON civicrm_contribution_product.contribution_id = civicrm_contribution.id GROUP BY contribution_id, product_id having count(*) > 1 ORDER BY receive_date;</code></p>
<p>Removing most of the duplicates:</p>
<p><code>mysql> ALTER IGNORE TABLE civicrm_contribution_product ADD UNIQUE INDEX `tmp_index` (contribution_id, product_id);</code></p>
<p>Removing the temporary index:</p>
<p><code>mysql> ALTER TABLE civicrm_contribution_product DROP INDEX tmp_index;</code></p>
<p>Thanks to Paul Swarthout's comments on <a href="http://www.databasejournal.com/features/mysql/article.php/10897_2201621_2/Deleting-Duplicate-Rows-in-a-MySQL-Database.htm">a thread</a> at <a href="http://www.databasejournal.com">databasejournal.com</a> for this simple solution.</p>

  </article>

</div>


	</div>

      </div>
      

    <footer>

    <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a></p>

    <p>Except where otherwise noted, content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>

    </footer>

    </div><!-- /.container -->

    <script async src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script async src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

  </body>
</html>
